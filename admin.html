<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Telegram Tips Admin â€” MatchIQ</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--muted:#94a3b8;--accent:#06b6d4;--good:#10b981}
    body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;background:linear-gradient(180deg,#071029 0%, #071b2b 100%);color:#e6eef6;margin:0;padding:24px}
    .container{max-width:980px;margin:0 auto}
    header{display:flex;align-items:center;gap:12px;margin-bottom:18px}
    header h1{font-size:20px;margin:0}
    .card{background:rgba(255,255,255,0.03);padding:16px;border-radius:12px;margin-bottom:12px;box-shadow:0 6px 18px rgba(2,6,23,0.6)}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    input[type="text"], textarea, select, input[type="time"]{
      width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);
      background:transparent;color:inherit;font-size:14px;box-sizing:border-box
    }
    textarea{min-height:90px;resize:vertical}
    .grid{display:grid;grid-template-columns:1fr 320px;gap:12px}
    .row{display:flex;gap:8px;flex-wraprap}
    button{background:var(--accent);color:#022;border:none;padding:10px 12px;border-radius:8px;cursor:pointer;font-weight:600}
    .muted{color:var(--muted);font-size:13px}
    .preview{white-space:pre-wrap;background:rgba(0,0,0,0.25);padding:12px;border-radius:8px;border:1px dashed rgba(255,255,255,0.04)}
    .history-item{padding:8px;border-radius:8px;background:rgba(255,255,255,0.02);margin-bottom:8px;font-size:13px}
    .small{font-size:13px;color:var(--muted)}
    .danger{background:#ef4444;color:#fff}
    .success{background:var(--good); color:#022}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <img src="" alt="" style="width:44px;height:44px;border-radius:8px;background:linear-gradient(135deg,#06b6d4,#0ea5a4)"/>
      <div>
        <h1>Telegram Tips Admin â€” MatchIQ</h1>
        <div class="small">Compose free / VIP tips, preview and send to your channel via your server</div>
      </div>
    </header>

    <!-- SETTINGS -->
    <div class="card">
      <label>Target Channel or Chat ID (e.g. @matchiqanalysis or -1001234567890)</label>
      <input id="target" placeholder="@matchiqanalysis" />
      <div style="margin-top:8px" class="small">This is the channel username or chat id your server will post to.</div>
    </div>

    <div class="grid">
      <!-- LEFT: Tip Builder -->
      <div>
        <div class="card">
          <label>Post Type</label>
          <select id="postType">
            <option value="free">Free Tip</option>
            <option value="vip">VIP Tip</option>
            <option value="result">Result / Update</option>
            <option value="announcement">Announcement</option>
          </select>

          <label style="margin-top:12px">Match (title)</label>
          <input id="match" placeholder="Arsenal vs Brighton" />

          <label style="margin-top:12px">Analysis (short)</label>
          <textarea id="analysis" placeholder="Key points: Home form, injuries, xG..." ></textarea>

          <label style="margin-top:12px">Tip / Correct Score</label>
          <input id="tip" placeholder="Correct Score â€” 2-1 or Over 2.5" />

          <div style="display:flex;gap:8px;margin-top:12px">
            <div style="flex:1">
              <label>Confidence</label>
              <select id="confidence">
                <option>Low</option>
                <option selected>Medium</option>
                <option>High</option>
              </select>
            </div>
            <div style="width:140px">
              <label>Kickoff (local/GMT)</label>
              <input id="kickoff" type="text" placeholder="20:00 GMT" />
            </div>
          </div>

          <label style="margin-top:12px">Extra Notes (optional)</label>
          <input id="notes" placeholder="e.g. Stake: 1/10, Only for VIP" />

          <div style="display:flex;gap:8px;margin-top:12px;align-items:center">
            <button id="previewBtn">Preview</button>
            <button id="sendBtn">Send</button>
            <button id="saveBtn" style="background:#334155">Save Locally</button>
            <button id="clearBtn" class="danger">Clear Form</button>
          </div>

          <div style="margin-top:10px" class="small">
            <strong>Note:</strong> This admin posts to <code>/api/sendTip</code> on your server. Keep your bot token on the server.
          </div>
        </div>

        <!-- Templates -->
        <div class="card">
          <label>Templates</label>
          <div class="row" style="margin-top:8px">
            <button onclick="useTemplate('free')">Free Tip</button>
            <button onclick="useTemplate('vip')">VIP Tip</button>
            <button onclick="useTemplate('result')">Result</button>
          </div>
          <div style="margin-top:10px" class="muted">
            Click a template to autofill the fields.
          </div>
        </div>

        <!-- History -->
        <div class="card">
          <label>Local History (saved in browser)</label>
          <div id="historyList" style="margin-top:10px;max-height:260px;overflow:auto"></div>
          <div style="display:flex;gap:8px;margin-top:10px">
            <button id="clearHistory" style="background:#334155">Clear History</button>
            <button id="exportHistory" style="background:#0ea5a4">Export JSON</button>
          </div>
        </div>
      </div>

      <!-- RIGHT: Preview + Response -->
      <div>
        <div class="card">
          <label>Preview</label>
          <div id="preview" class="preview">Fill the form and click Preview</div>
        </div>

        <div class="card">
          <label>Last Server Response</label>
          <pre id="serverResp" class="preview">No requests yet.</pre>
        </div>

        <div class="card">
          <label>Disclaimer (auto-added to posts)</label>
          <div class="small">
            All predictions are opinions based on analysis and statistics. No guaranteed outcomes. Bet responsibly.
          </div>
        </div>
      </div>
    </div>

    <footer style="margin-top:14px;text-align:center;color:var(--muted);font-size:13px">
      Built for MatchIQ â€¢ Keep your bot token on your server â€¢ Â© Your Brand
    </footer>
  </div>

  <script>
    // ---------- Basic UI helpers ----------
    const targetEl = document.getElementById('target');
    const postTypeEl = document.getElementById('postType');
    const matchEl = document.getElementById('match');
    const analysisEl = document.getElementById('analysis');
    const tipEl = document.getElementById('tip');
    const confidenceEl = document.getElementById('confidence');
    const kickoffEl = document.getElementById('kickoff');
    const notesEl = document.getElementById('notes');
    const previewEl = document.getElementById('preview');
    const serverRespEl = document.getElementById('serverResp');
    const historyList = document.getElementById('historyList');

    // Load history from localStorage
    let history = JSON.parse(localStorage.getItem('tipHistory') || '[]');
    renderHistory();

    // Templates
    function useTemplate(name){
      if(name==='free'){
        postTypeEl.value='free';
        matchEl.value='Man City vs Wolves';
        analysisEl.value='Man City strong at home; Wolves weak defense.';
        tipEl.value='Over 2.5 Goals';
        confidenceEl.value='Medium';
        kickoffEl.value='20:00 GMT'
      } else if(name==='vip'){
        postTypeEl.value='vip';
        matchEl.value='Arsenal vs Brighton';
        analysisEl.value='Arsenal unbeaten last 5; Brighton poor away.';
        tipEl.value='Correct Score â€” 2â€“1';
        confidenceEl.value='High';
        kickoffEl.value='18:45 GMT';
        notesEl.value='VIP: small stake recommended.';
      } else if(name==='result'){
        postTypeEl.value='result';
        matchEl.value='Man Utd vs Chelsea';
        analysisEl.value='';
        tipEl.value='Result: 1â€“1 (Over 1.5)';
        confidenceEl.value='Low';
        kickoffEl.value='';
      }
    }

    // Compose preview text
    function buildPost(){
      const postType = postTypeEl.value;
      let lines = [];
      if(postType === 'announcement') lines.push('ðŸ“¢ ANNOUNCEMENT');
      if(postType === 'vip') lines.push('ðŸ’Ž VIP ANALYSIS');
      if(postType === 'free') lines.push('ðŸ†“ FREE TIP');
      if(postType === 'result') lines.push('âœ… RESULT');

      if(matchEl.value) lines.push('âš½ Match: ' + matchEl.value);
      if(analysisEl.value) lines.push('ðŸ“Š Analysis: ' + analysisEl.value);
      if(tipEl.value) lines.push('ðŸŽ¯ Tip: ' + tipEl.value);
      if(confidenceEl.value) lines.push('ðŸ“ˆ Confidence: ' + confidenceEl.value);
      if(kickoffEl.value) lines.push('ðŸ•’ Kickoff: ' + kickoffEl.value);
      if(notesEl.value) lines.push('ðŸ“ Notes: ' + notesEl.value);

      lines.push('\nâš ï¸ Disclaimer: All tips are predictions based on analysis. No guarantees. Bet responsibly.');
      return lines.join('\n');
    }

    // Preview
    document.getElementById('previewBtn').addEventListener('click', ()=>{
      previewEl.textContent = buildPost();
    });

    // Save to local history
    document.getElementById('saveBtn').addEventListener('click', ()=>{
      const item = {
        id: Date.now(),
        target: targetEl.value,
        postType: postTypeEl.value,
        match: matchEl.value, analysis: analysisEl.value, tip: tipEl.value,
        confidence: confidenceEl.value, kickoff: kickoffEl.value, notes: notesEl.value,
        text: buildPost()
      };
      history.unshift(item);
      if(history.length>200) history.pop();
      localStorage.setItem('tipHistory', JSON.stringify(history));
      renderHistory();
      alert('Saved locally.');
    });

    function renderHistory(){
      historyList.innerHTML = '';
      if(history.length===0){ historyList.innerHTML = '<div class="small">No saved posts yet.</div>'; return;}
      history.forEach(h=>{
        const d = document.createElement('div'); d.className='history-item';
        d.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center">
          <div><strong>${escapeHtml(h.match||h.postType)}</strong><div class="small">${escapeHtml(h.postType)} â€¢ ${new Date(h.id).toLocaleString()}</div></div>
          <div style="display:flex;gap:6px">
            <button onclick='useHistory(${h.id})'>Load</button>
            <button onclick='sendFromHistory(${h.id})' style="background:#0ea5a4">Send</button>
          </div>
        </div>
        <div style="margin-top:8px" class="small">${escapeHtml(h.text)}</div>`;
        historyList.appendChild(d);
      });
    }

    // Load history item into form
    window.useHistory = function(id){
      const h = history.find(x=>x.id===id);
      if(!h) return alert('Not found');
      targetEl.value = h.target || '';
      postTypeEl.value = h.postType || 'free';
      matchEl.value = h.match || '';
      analysisEl.value = h.analysis || '';
      tipEl.value = h.tip || '';
      confidenceEl.value = h.confidence || 'Medium';
      kickoffEl.value = h.kickoff || '';
      notesEl.value = h.notes || '';
      previewEl.textContent = buildPost();
    }

    // Send the composed post to your server
    document.getElementById('sendBtn').addEventListener('click', async ()=>{
      const payload = {
        target: targetEl.value || '',
        text: buildPost(),
        meta: {
          postType: postTypeEl.value,
          match: matchEl.value,
          tip: tipEl.value,
          confidence: confidenceEl.value,
          kickoff: kickoffEl.value,
          notes: notesEl.value
        }
      };
      // Basic client-side validation
      if(!payload.target){
        return alert('Enter target channel or chat id');
      }
      if(!payload.text){
        return alert('Compose a tip first');
      }

      try{
        serverRespEl.textContent = 'Sending...';
        const res = await fetch('/api/sendTip', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify(payload)
        });
        const data = await res.json();
        serverRespEl.textContent = JSON.stringify(data, null, 2);
        if(res.ok){
          // save to local history automatically
          history.unshift({
            id: Date.now(), target: payload.target, postType: postTypeEl.value,
            match: matchEl.value, analysis: analysisEl.value, tip: tipEl.value,
            confidence: confidenceEl.value, kickoff: kickoffEl.value, notes: notesEl.value, text: payload.text
          });
          localStorage.setItem('tipHistory', JSON.stringify(history));
          renderHistory();
        }
      }catch(err){
        serverRespEl.textContent = 'Request failed: ' + err.message;
      }
    });

    // Send directly from history (shortcut)
    window.sendFromHistory = async function(id){
      const h = history.find(x=>x.id===id);
      if(!h) return alert('Not found');
      if(!confirm('Send this saved post?')) return;
      try{
        serverRespEl.textContent = 'Sending...';
        const res = await fetch('/api/sendTip', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ target: h.target||targetEl.value, text: h.text, meta: h })
        });
        const d = await res.json();
        serverRespEl.textContent = JSON.stringify(d, null, 2);
      }catch(err){
        serverRespEl.textContent = 'Request failed: ' + err.message;
      }
    }

    // Clear form
    document.getElementById('clearBtn').addEventListener('click', ()=>{
      if(!confirm('Clear the form?')) return;
      matchEl.value='';analysisEl.value='';tipEl.value='';confidenceEl.value='Medium';kickoffEl.value='';notesEl.value='';
      previewEl.textContent = 'Fill the form and click Preview';
    });

    // Export / Clear history
    document.getElementById('clearHistory').addEventListener('click', ()=>{
      if(!confirm('Clear saved history?')) return;
      history = []; localStorage.removeItem('tipHistory'); renderHistory();
    });
    document.getElementById('exportHistory').addEventListener('click', ()=>{
      const blob = new Blob([JSON.stringify(history, null, 2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'tip_history.json'; a.click(); URL.revokeObjectURL(url);
    });

    // Escape HTML for safety when rendering
    function escapeHtml(str=''){ return String(str).replace(/[&<>"']/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[s])); }

  </script>
</body>
</html>
