<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Telegram Admin â€” MatchIQ</title>
<style>
:root{
  --bg:#0f1724;
  --card:#0b1220;
  --muted:#94a3b8;
  --accent:#06b6d4;
  --good:#10b981;
  --warn:#facc15;
  --danger:#ef4444;
}
body{
  font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
  background:linear-gradient(180deg,#071029 0%, #071b2b 100%);
  color:#e6eef6;margin:0;padding:24px;
}
.container{max-width:1100px;margin:0 auto;}
header{display:flex;align-items:center;gap:12px;margin-bottom:18px;}
header h1{font-size:20px;margin:0;}
.card{
  background:rgba(255,255,255,0.03);
  padding:16px;
  border-radius:12px;
  margin-bottom:12px;
  box-shadow:0 6px 18px rgba(2,6,23,0.6);
}
label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px;}
input[type="text"],textarea,select{
  width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);
  background:transparent;color:inherit;font-size:14px;box-sizing:border-box;
}
textarea{min-height:90px;resize:vertical;}
button{
  background:var(--accent);color:#022;border:none;padding:10px 12px;border-radius:8px;
  cursor:pointer;font-weight:600;
}
button.danger{background:var(--danger);}
button.success{background:var(--good);}
.small{font-size:13px;color:var(--muted);}
.grid{display:grid;grid-template-columns:2fr 1fr;gap:12px;}
.sub-list{max-height:250px;overflow:auto;margin-top:8px;}
.sub-item{padding:8px;border-radius:8px;background:rgba(255,255,255,0.02);margin-bottom:6px;display:flex;justify-content:space-between;align-items:center;font-size:13px;}
.badge{padding:2px 6px;border-radius:6px;font-size:12px;color:#022;}
.badge.active{background:var(--good);}
.badge.expired{background:var(--danger);}
.badge.warn{background:var(--warn);}
</style>
</head>
<body>
<div class="container">
  <header>
    <img src="" alt="Admin Logo" style="width:44px;height:44px;border-radius:8px;background:linear-gradient(135deg,#06b6d4,#0ea5a4)"/>
    <div>
      <h1>Telegram Admin â€” MatchIQ</h1>
      <div class="small">Manage tips, VIP subscriptions, and subscribers</div>
    </div>
  </header>

  <div class="grid">
    <!-- LEFT: Compose Tips -->
    <div>
      <div class="card">
        <label>Post Type</label>
        <select id="postType">
          <option value="free">Free Tip</option>
          <option value="vip">VIP Tip</option>
        </select>

        <label style="margin-top:12px">Match (Title)</label>
        <input id="match" placeholder="Arsenal vs Brighton">

        <label style="margin-top:12px">Analysis / Tip</label>
        <textarea id="analysis" placeholder="Key points or score tips"></textarea>

        <label style="margin-top:12px">Extra Notes (Optional)</label>
        <input id="notes" placeholder="VIP small stake, etc.">

        <div style="display:flex;gap:8px;margin-top:12px">
          <button id="previewBtn">Preview</button>
          <button id="sendBtn">Send</button>
          <button id="saveBtn" class="success">Save Locally</button>
          <button id="clearBtn" class="danger">Clear</button>
        </div>

        <div style="margin-top:10px" class="small">
          VIP tips are sent only to active subscribers. Free tips go to all users.
        </div>

        <div style="margin-top:10px">
          <label>Preview</label>
          <div id="preview" style="white-space:pre-wrap;background:rgba(0,0,0,0.25);padding:12px;border-radius:8px;border:1px dashed rgba(255,255,255,0.04)">
            Fill the form and click Preview
          </div>
        </div>
      </div>
    </div>

    <!-- RIGHT: Subscriber List -->
    <div>
      <div class="card">
        <label>Subscribers</label>
        <div id="subList" class="sub-list">Loading subscribers...</div>
      </div>
    </div>
  </div>
</div>

<script>
const postTypeEl = document.getElementById('postType');
const matchEl = document.getElementById('match');
const analysisEl = document.getElementById('analysis');
const notesEl = document.getElementById('notes');
const previewEl = document.getElementById('preview');
const subListEl = document.getElementById('subList');

async function loadSubscribers(){
  try{
    const res = await fetch('/subscribers.json');
    const subs = await res.json();
    renderSubscribers(subs);
  }catch(e){
    subListEl.innerHTML='Failed to load subscribers';
  }
}

function renderSubscribers(subs){
  subListEl.innerHTML='';
  subs.forEach(s=>{
    const now = new Date();
    const expiry = new Date(s.expiry);
    let badgeClass='active', badgeText='Active';
    const diffDays = (expiry-now)/(1000*60*60*24);
    if(!s.active) { badgeClass='expired'; badgeText='Expired'; }
    else if(diffDays<=1) { badgeClass='warn'; badgeText='Expiring Soon'; }

    const div = document.createElement('div');
    div.className='sub-item';
    div.innerHTML=`
      <div><strong>${s.username}</strong> (${s.type})</div>
      <div>
        <span class="badge ${badgeClass}">${badgeText}</span>
      </div>
    `;
    subListEl.appendChild(div);
  });
}

// Preview
document.getElementById('previewBtn').addEventListener('click', ()=>{
  let lines=[];
  const postType = postTypeEl.value;
  if(postType==='vip') lines.push('ðŸ’Ž VIP TIP');
  else lines.push('ðŸ†“ FREE TIP');
  if(matchEl.value) lines.push('âš½ Match: '+matchEl.value);
  if(analysisEl.value) lines.push('ðŸ“Š Analysis: '+analysisEl.value);
  if(notesEl.value) lines.push('ðŸ“ Notes: '+notesEl.value);
  lines.push('\nâš ï¸ Disclaimer: All tips are predictions. No guarantees. Bet responsibly.');
  previewEl.textContent = lines.join('\n');
});

// Send tip
document.getElementById('sendBtn').addEventListener('click', async ()=>{
  const text = previewEl.textContent;
  const postType = postTypeEl.value;
  try{
    const res = await fetch('/api/sendTip',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({
        target:'', text, meta:{ postType, match:matchEl.value, notes:notesEl.value }
      })
    });
    const data = await res.json();
    alert('Tip sent successfully!');
  }catch(e){
    alert('Failed to send tip');
  }
});

// Clear form
document.getElementById('clearBtn').addEventListener('click', ()=>{
  matchEl.value=''; analysisEl.value=''; notesEl.value='';
  previewEl.textContent='Fill the form and click Preview';
});

loadSubscribers();
</script>
</body>
</html>
