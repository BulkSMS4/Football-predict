<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Telegram Admin Dashboard — MatchIQ</title>
<style>
:root {
  --bg: #0f1724;
  --card: #0b1220;
  --muted: #94a3b8;
  --accent: #06b6d4;
  --good: #10b981;
  --warn: #f59e0b;
  --danger: #ef4444;
}
body {
  font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial;
  background: linear-gradient(180deg,#071029 0%, #071b2b 100%);
  color: #e6eef6;
  margin:0;
  padding:24px;
}
.container { max-width:1200px; margin:0 auto; }
header { display:flex; align-items:center; gap:12px; margin-bottom:18px; }
header img { width:50px; height:50px; border-radius:10px; background: linear-gradient(135deg,#06b6d4,#0ea5a4); }
header h1 { font-size:22px; margin:0; }
header .small { font-size:13px; color:var(--muted); }

.card { background: rgba(255,255,255,0.03); padding:16px; border-radius:12px; margin-bottom:12px; box-shadow:0 6px 18px rgba(2,6,23,0.6); }
input, select, textarea { width:100%; padding:10px; border-radius:8px; border:1px solid rgba(255,255,255,0.06); background:transparent; color:inherit; font-size:14px; box-sizing:border-box; }
textarea { min-height:80px; resize:vertical; }
button { background: var(--accent); color:#022; border:none; padding:10px 12px; border-radius:8px; cursor:pointer; font-weight:600; }
button.danger { background: var(--danger); color:#fff; }
button.success { background: var(--good); color:#022; }
.grid { display:grid; grid-template-columns:1fr 1fr; gap:12px; }
table { width:100%; border-collapse:collapse; }
th, td { padding:8px; border-bottom:1px solid rgba(255,255,255,0.1); text-align:left; font-size:13px; }
th { color: var(--accent); }
.status-active { color: var(--good); font-weight:600; }
.status-expired { color: var(--danger); font-weight:600; }
.small { font-size:13px; color: var(--muted); }
</style>
</head>
<body>

<div class="container">

  <header>
    <img src="" alt="Admin Logo">
    <div>
      <h1>Telegram Admin Dashboard — MatchIQ</h1>
      <div class="small">Manage VIP tips, subscribers, and chat logs</div>
    </div>
  </header>

  <!-- LOGIN -->
  <div class="card" id="loginCard">
    <label>Admin Password</label>
    <input type="password" id="adminPassword" placeholder="Enter password">
    <button id="loginBtn" style="margin-top:12px;">Login</button>
    <div class="small" style="margin-top:6px;">Password is required to access the dashboard</div>
  </div>

  <!-- DASHBOARD -->
  <div id="dashboard" style="display:none;">

    <!-- VIP Tip Post -->
    <div class="card">
      <label>Post VIP Tip</label>
      <textarea id="vipTip" placeholder="Compose your VIP tip here"></textarea>
      <button id="sendVipBtn" style="margin-top:8px;">Send Tip</button>
      <div class="small" style="margin-top:4px;">This will send the tip to all active VIP subscribers.</div>
    </div>

    <!-- Subscribers List -->
    <div class="card">
      <label>Subscribers</label>
      <table id="subscribersTable">
        <thead>
          <tr><th>Username</th><th>Type</th><th>Expiry</th><th>Status</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- Chat Logs -->
    <div class="card">
      <label>Chat Logs</label>
      <table id="logsTable">
        <thead>
          <tr><th>Username</th><th>Type</th><th>Message</th><th>Time</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

  </div>
</div>

<script>
const ADMIN_PASSWORD = "YOUR_ADMIN_PASSWORD"; // replace with your password

// LOGIN
const loginBtn = document.getElementById('loginBtn');
const adminPassword = document.getElementById('adminPassword');
const loginCard = document.getElementById('loginCard');
const dashboard = document.getElementById('dashboard');

loginBtn.addEventListener('click', () => {
  if(adminPassword.value === ADMIN_PASSWORD){
    loginCard.style.display = 'none';
    dashboard.style.display = 'block';
    loadSubscribers();
    loadLogs();
  } else {
    alert('Incorrect password');
  }
});

// LOAD Subscribers
async function loadSubscribers(){
  try{
    const res = await fetch('/api/subscribers');
    const data = await res.json();
    const tbody = document.querySelector('#subscribersTable tbody');
    tbody.innerHTML = '';
    data.forEach(sub => {
      const tr = document.createElement('tr');
      const status = sub.active ? 'Active' : 'Expired';
      const expiryDate = new Date(sub.expiry).toLocaleString();
      tr.innerHTML = `<td>${sub.username}</td><td>${sub.type}</td><td>${expiryDate}</td><td class="status-${sub.active ? 'active':'expired'}">${status}</td>`;
      tbody.appendChild(tr);
    });
  }catch(e){ console.error(e); }
}

// LOAD Chat Logs
async function loadLogs(){
  try{
    const res = await fetch('/api/chatlogs');
    const data = await res.json();
    const tbody = document.querySelector('#logsTable tbody');
    tbody.innerHTML = '';
    data.forEach(log => {
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${log.username}</td><td>${log.type}</td><td>${log.message}</td><td>${new Date(log.timestamp).toLocaleString()}</td>`;
      tbody.appendChild(tr);
    });
  }catch(e){ console.error(e); }
}

// SEND VIP TIP to all active subscribers
document.getElementById('sendVipBtn').addEventListener('click', async ()=>{
  const tip = document.getElementById('vipTip').value.trim();
  if(!tip) return alert('Write VIP tip first');

  try{
    const res = await fetch('/api/subscribers');
    const subs = await res.json();
    const activeSubs = subs.filter(s=>s.active);

    for(const s of activeSubs){
      await fetch('/api/sendTip', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ target:s.chatId, text:tip })
      });
    }

    alert(`Sent to ${activeSubs.length} active subscribers`);
    document.getElementById('vipTip').value = '';
    loadLogs();
  }catch(e){ console.error(e); alert('Error sending tips'); }
});
</script>

</body>
</html>
