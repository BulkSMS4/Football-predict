<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Telegram Tips Admin â€” MatchIQ</title>
<style>
  :root{--bg:#0f1724;--card:#0b1220;--muted:#94a3b8;--accent:#06b6d4;--good:#10b981}
  body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;background:linear-gradient(180deg,#071029 0%, #071b2b 100%);color:#e6eef6;margin:0;padding:24px}
  .container{max-width:980px;margin:0 auto}
  header{display:flex;align-items:center;gap:12px;margin-bottom:18px}
  header h1{font-size:20px;margin:0}
  .card{background:rgba(255,255,255,0.03);padding:16px;border-radius:12px;margin-bottom:12px;box-shadow:0 6px 18px rgba(2,6,23,0.6)}
  label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
  input[type="text"], textarea, select, input[type="time"]{
    width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);
    background:transparent;color:inherit;font-size:14px;box-sizing:border-box
  }
  textarea{min-height:90px;resize:vertical}
  .grid{display:grid;grid-template-columns:1fr 320px;gap:12px}
  .row{display:flex;gap:8px;flex-wrap:wrap}
  button{background:var(--accent);color:#022;border:none;padding:10px 12px;border-radius:8px;cursor:pointer;font-weight:600}
  .muted{color:var(--muted);font-size:13px}
  .preview{white-space:pre-wrap;background:rgba(0,0,0,0.25);padding:12px;border-radius:8px;border:1px dashed rgba(255,255,255,0.04)}
  .history-item{padding:8px;border-radius:8px;background:rgba(255,255,255,0.02);margin-bottom:8px;font-size:13px}
  .small{font-size:13px;color:var(--muted)}
  .danger{background:#ef4444;color:#fff}
  .success{background:var(--good); color:#022}
  table{width:100%;border-collapse:collapse;color:#e6eef6}
  th,td{border:1px solid rgba(255,255,255,0.1);padding:6px;text-align:left;font-size:13px}
</style>
</head>
<body>
<div class="container">
  <header>
    <img src="" alt="" style="width:44px;height:44px;border-radius:8px;background:linear-gradient(135deg,#06b6d4,#0ea5a4)"/>
    <div>
      <h1>Telegram Tips Admin â€” MatchIQ</h1>
      <div class="small">Compose free / VIP tips, preview, send & manage subscribers</div>
    </div>
  </header>

  <div class="card">
    <label>Target Channel or Chat ID (e.g. @matchiqanalysis or -1001234567890)</label>
    <input id="target" placeholder="@matchiqanalysis" />
  </div>

  <div class="grid">
    <!-- LEFT: Tip Builder -->
    <div>
      <div class="card">
        <label>Post Type</label>
        <select id="postType">
          <option value="free">Free Tip</option>
          <option value="vip">VIP Tip</option>
          <option value="result">Result / Update</option>
          <option value="announcement">Announcement</option>
        </select>

        <label style="margin-top:12px">Match (title)</label>
        <input id="match" placeholder="Arsenal vs Brighton" />

        <label style="margin-top:12px">Analysis (short)</label>
        <textarea id="analysis" placeholder="Key points: Home form, injuries, xG..." ></textarea>

        <label style="margin-top:12px">Tip / Correct Score</label>
        <input id="tip" placeholder="Correct Score â€” 2-1 or Over 2.5" />

        <div style="display:flex;gap:8px;margin-top:12px">
          <div style="flex:1">
            <label>Confidence</label>
            <select id="confidence">
              <option>Low</option>
              <option selected>Medium</option>
              <option>High</option>
            </select>
          </div>
          <div style="width:140px">
            <label>Kickoff (local/GMT)</label>
            <input id="kickoff" type="text" placeholder="20:00 GMT" />
          </div>
        </div>

        <label style="margin-top:12px">Extra Notes (optional)</label>
        <input id="notes" placeholder="e.g. Stake: 1/10, Only for VIP" />

        <div style="display:flex;gap:8px;margin-top:12px;align-items:center">
          <button id="previewBtn">Preview</button>
          <button id="sendBtn">Send</button>
          <button id="saveBtn" style="background:#334155">Save Locally</button>
          <button id="clearBtn" class="danger">Clear Form</button>
        </div>
      </div>

      <!-- Subscriber Management -->
      <div class="card">
        <label>Subscriber List</label>
        <table>
          <thead><tr><th>Username</th><th>Chat ID</th><th>Type</th><th>Expiry</th></tr></thead>
          <tbody id="subscriberList"></tbody>
        </table>
        <button id="refreshSubs" style="margin-top:6px">Refresh Subscriber List</button>
      </div>
    </div>

    <!-- RIGHT: Preview + Response -->
    <div>
      <div class="card">
        <label>Preview</label>
        <div id="preview" class="preview">Fill the form and click Preview</div>
      </div>

      <div class="card">
        <label>Last Server Response</label>
        <pre id="serverResp" class="preview">No requests yet.</pre>
      </div>
    </div>
  </div>

  <footer style="margin-top:14px;text-align:center;color:var(--muted);font-size:13px">
    Built for MatchIQ â€¢ Keep your bot token on your server â€¢ Â© Your Brand
  </footer>
</div>

<script>
const targetEl = document.getElementById('target');
const postTypeEl = document.getElementById('postType');
const matchEl = document.getElementById('match');
const analysisEl = document.getElementById('analysis');
const tipEl = document.getElementById('tip');
const confidenceEl = document.getElementById('confidence');
const kickoffEl = document.getElementById('kickoff');
const notesEl = document.getElementById('notes');
const previewEl = document.getElementById('preview');
const serverRespEl = document.getElementById('serverResp');
const subscriberListEl = document.getElementById('subscriberList');

// --- Preview ---
function buildPost(){
  const postType = postTypeEl.value;
  let lines = [];
  if(postType==='announcement') lines.push('ðŸ“¢ ANNOUNCEMENT');
  if(postType==='vip') lines.push('ðŸ’Ž VIP ANALYSIS');
  if(postType==='free') lines.push('ðŸ†“ FREE TIP');
  if(postType==='result') lines.push('âœ… RESULT');

  if(matchEl.value) lines.push('âš½ Match: ' + matchEl.value);
  if(analysisEl.value) lines.push('ðŸ“Š Analysis: ' + analysisEl.value);
  if(tipEl.value) lines.push('ðŸŽ¯ Tip: ' + tipEl.value);
  if(confidenceEl.value) lines.push('ðŸ“ˆ Confidence: ' + confidenceEl.value);
  if(kickoffEl.value) lines.push('ðŸ•’ Kickoff: ' + kickoffEl.value);
  if(notesEl.value) lines.push('ðŸ“ Notes: ' + notesEl.value);

  lines.push('\nâš ï¸ Disclaimer: All tips are predictions based on analysis. No guarantees. Bet responsibly.');
  return lines.join('\n');
}

document.getElementById('previewBtn').addEventListener('click', ()=>{
  previewEl.textContent = buildPost();
});

// --- Send Tip ---
document.getElementById('sendBtn').addEventListener('click', async ()=>{
  const payload = {
    target: targetEl.value || '',
    text: buildPost(),
    postType: postTypeEl.value
  };
  if(!payload.text) return alert('Compose a tip first');
  if(!payload.target && payload.postType!=='vip') return alert('Enter target channel or chat id');

  try{
    serverRespEl.textContent='Sending...';
    const res = await fetch('/api/sendTip', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify(payload)
    });
    const data = await res.json();
    serverRespEl.textContent = JSON.stringify(data,null,2);
  }catch(err){
    serverRespEl.textContent = 'Request failed: ' + err.message;
  }
});

// --- Subscriber List ---
async function loadSubscribers(){
  const res = await fetch('/api/subscribers');
  const data = await res.json();
  subscriberListEl.innerHTML='';
  data.forEach(s=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${s.username}</td><td>${s.id}</td><td>${s.subscriptionType}</td><td>${new Date(s.endDate).toLocaleString()}</td>`;
    subscriberListEl.appendChild(tr);
  });
}
document.getElementById('refreshSubs').addEventListener('click', loadSubscribers);
loadSubscribers();
</script>
</body>
</html>
